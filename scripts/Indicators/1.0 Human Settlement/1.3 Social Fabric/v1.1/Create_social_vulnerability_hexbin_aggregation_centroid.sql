-- test aggregation to hexbin grids via area proxy
--5km
DROP VIEW IF EXISTS results_nhsl_social_fabric.nhsl_social_fabric_all_indicators_hexgrid_5km_centroid;
CREATE VIEW results_nhsl_social_fabric.nhsl_social_fabric_all_indicators_hexgrid_5km_centroid AS 
SELECT
b.gridid_5,
SUM("SVlt_Score") AS "SVlt_Score",

--1.3.1 Housing Conditions
SUM("VHt_Score") AS "VHt_Score",
AVG("VH_PopHa") AS "VH_PopHa",
AVG("VHn_PopHa") AS "VHn_PopHa",
SUM("VHt_PopHa") AS "VHt_PopHa",
AVG("VH_Pre1975") AS "VH_Pre1975",
AVG("VHn_Pre1975") AS "VHn_Pre1975",
SUM("VHtPre1975") AS "VHtPre1975",
AVG("VH_NSuit") AS "VH_NSuit",
AVG("VHn_NSuit") AS "VHn_NSuit",
SUM("VHt_NSuit") AS "VHt_NSuit",
AVG("VH_MntnAge") AS "VH_MntnAge",
AVG("VHn_MntnAge") AS "VHn_MntnAge",
SUM("VHt_MntnAge") AS "VHt_MntnAge",
AVG("VH_Mntn1") AS "VH_Mntn1",
AVG("VHn_Mntn1") AS "VHn_Mntn1",
SUM("VHt_Mntn1") AS "VHt_Mntn1",
AVG("VH_Renter") AS "VH_Renter",
AVG("VHn_Renter") AS "VHn_Renter",
SUM("VHt_Renter") AS "VHt_Renter",
AVG("VH_NonResHa") AS "VH_NonResHa",
AVG("VHn_NonResHa") AS "VHn_NonResHa",
SUM("VHt_NonResHa") AS "VHt_NonResHa",

--1.3.2 Social Connections
SUM("VFt_Score") AS "VFt_Score",
AVG("VF_LivAlone") AS "VF_LivAlone",
AVG("VFn_LivAlone") AS "VFn_LivAlone" ,
SUM("VFt_LivAlone") AS "VFt_LivAlone",
AVG("VF_LonPar3Kids") AS "VF_LonPar3Kids",
AVG("VFn_LonPar3Kids") AS "VFn_LonPar3Kids",
SUM("VFt_LonPar3Kids") AS "VFt_LonPar3Kids",
AVG("VF_FamGT5") AS "VF_FamGT5",
AVG("VFn_FamGT5") AS "VFn_FamGT5",
SUM("VFt_FamGT5") AS "VFt_FamGT5",
AVG("VF_MovedLT1") AS "VF_MovedLT1",
AVG("VFn_MovedLT1") AS "VFn_MovedLT1",
SUM("VFt_MovedLT1") AS "VFt_MovedLT1",
AVG("VF_ImmLT5") AS "VF_ImmLT5",
AVG("VFn_Imm_LT5") AS "VFn_Imm_LT5",
SUM("VFt_ImmLT5") AS"VFt_ImmLT5" ,
AVG("VF_NoWrkPlace") AS "VF_NoWrkPlace",
AVG("VFn_NoWrkPlace") AS "VFn_NoWrkPlace",
SUM("VFt_NoWrkPlace") AS "VFt_NoWrkPlace",

--1.3.3 Individual Autonomy
SUM("VAt_Score") AS "VAt_Score",
AVG("VA_NoEngFr") AS "VA_NoEngFr",
AVG("VAn_NoEngFr") AS "VAn_NoEngFr",
SUM("VAt_NoEngFr") AS "VAt_NoEngFr",
AVG("VA_NoSecED") AS "VA_NoSecED",
AVG("VAn_NoSecED") AS "VAn_NoSecED",
SUM("VAt_NoSecED") AS "VAt_NoSecED",
AVG("VA_AgeGT65") AS "VA_AgeGT65",
AVG("VAn_AgeGT65") AS "VAn_AgeGT65",
SUM("VAt_AgeGT65") AS "VAt_AgeGT65",
AVG("VA_AgeLT6") AS "VA_AgeLT6",
AVG("VAn_AgeLT6") AS "VAn_AgeLT6",
SUM("VAt_AgeLT6") AS "VAt_AgeLT6",
AVG("VA_Indigenous") AS "VA_Indigenous",
AVG("VAn_Indigenous") AS "VAn_Indigenous",
SUM("VAt_Indigenous") AS "VAt_Indigenous",
AVG("VA_VisMinority") AS "VA_VisMinority",
AVG("VAn_VisMinority") AS "VAn_VisMinority",
SUM("VAt_VisMinority") AS "VAt_VisMinority",
PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY "VA_AgeMedian") AS "VA_AgeMedian",
AVG("VAn_AgeMedian") AS "VAn_AgeMedian",
SUM("VAt_AgeMedian") AS "VAt_AgeMedian",
AVG("VA_Health") AS "VA_Health",
AVG("VAn_Health") AS "VAn_Health",
SUM("VAt_Health") AS "VAt_Health",
AVG("VA_PubTrans") AS "VA_PubTrans",
AVG("VAn_PubTrans") AS "VAn_PubTrans",
SUM("VAt_PubTrans") AS "VAt_PubTrans",

--1.3.4 Financial Agency
SUM("VEt_Score") AS "VEt_Score",
AVG("VE_ShltrGT30") AS "VE_ShltrGT30",
AVG("VEn_ShltrGT30") AS "VEn_ShltrGT30",
SUM("VEt_ShltrGT30") AS "VEt_ShltrGT30",
AVG("VE_LowIncDec") AS "VE_LowIncDec",
AVG("VEn_LowIncDec") AS "VEn_LowIncDec",
SUM("VEt_LowIncDec") AS "VEt_LowIncDec",
AVG("VE_Unemployed") AS "VE_Unemployed",
AVG("VEn_Unemployed") AS "VEn_Unemployed",
SUM("VEt_Unemployed") AS "VEt_Unemployed",
AVG("VE_IncEmploy") AS "VE_IncEmploy",
AVG("VEn_IncEmploy") AS "VEn_IncEmploy",
SUM("VEt_IncEmploy") AS "VEt_IncEmploy",
PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY "VE_IndivInc") AS "VE_IndivInc",
AVG("VEn_IndivInc") AS "VEn_IndivInc",
SUM("VEt_IndivInc") AS "VEt_IndivInc",
PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY "VE_HshldInc") AS "VE_HshldInc",
AVG("VEn_HshldInc") AS "VEn_HshldInc",
SUM("VEt_HshldInc") AS "VEt_HshldInc",
AVG("VE_Retail") AS "VE_Retail",
AVG("VEn_Retail") AS "VEn_Retail",
SUM("VEt_Retail") AS "VEt_Retail",
AVG("VE_WorkNone") AS "VE_WorkNone",
AVG("VEn_WorkNone") AS "VEn_WorkNone" ,
SUM("VEt_WorkNone") AS "VEt_WorkNone",
AVG("VE_WorkPart") AS "VE_WorkPart",
AVG("VEn_WorkPart") AS "VEn_WorkPart",
SUM("VEt_WorkPart") AS "VEt_WorkPart",

c.geom

FROM results_nhsl_social_fabric.nhsl_social_fabric_all_indicators_s a
LEFT JOIN boundaries."SAUID_HexGrid" b ON a."Sauid" = b.sauid
LEFT JOIN boundaries."HexGrid_5km" c ON b.gridid_5 = c.gridid_5
GROUP BY b.gridid_5,c.geom;



--10km
DROP VIEW IF EXISTS results_nhsl_social_fabric.nhsl_social_fabric_all_indicators_hexgrid_10km_centroid;
CREATE VIEW results_nhsl_social_fabric.nhsl_social_fabric_all_indicators_hexgrid_10km_centroid AS 
SELECT
b.gridid_10,
SUM("SVlt_Score") AS "SVlt_Score",

--1.3.1 Housing Conditions
SUM("VHt_Score") AS "VHt_Score",
AVG("VH_PopHa") AS "VH_PopHa",
AVG("VHn_PopHa") AS "VHn_PopHa",
SUM("VHt_PopHa") AS "VHt_PopHa",
AVG("VH_Pre1975") AS "VH_Pre1975",
AVG("VHn_Pre1975") AS "VHn_Pre1975",
SUM("VHtPre1975") AS "VHtPre1975",
AVG("VH_NSuit") AS "VH_NSuit",
AVG("VHn_NSuit") AS "VHn_NSuit",
SUM("VHt_NSuit") AS "VHt_NSuit",
AVG("VH_MntnAge") AS "VH_MntnAge",
AVG("VHn_MntnAge") AS "VHn_MntnAge",
SUM("VHt_MntnAge") AS "VHt_MntnAge",
AVG("VH_Mntn1") AS "VH_Mntn1",
AVG("VHn_Mntn1") AS "VHn_Mntn1",
SUM("VHt_Mntn1") AS "VHt_Mntn1",
AVG("VH_Renter") AS "VH_Renter",
AVG("VHn_Renter") AS "VHn_Renter",
SUM("VHt_Renter") AS "VHt_Renter",
AVG("VH_NonResHa") AS "VH_NonResHa",
AVG("VHn_NonResHa") AS "VHn_NonResHa",
SUM("VHt_NonResHa") AS "VHt_NonResHa",

--1.3.2 Social Connections
SUM("VFt_Score") AS "VFt_Score",
AVG("VF_LivAlone") AS "VF_LivAlone",
AVG("VFn_LivAlone") AS "VFn_LivAlone" ,
SUM("VFt_LivAlone") AS "VFt_LivAlone",
AVG("VF_LonPar3Kids") AS "VF_LonPar3Kids",
AVG("VFn_LonPar3Kids") AS "VFn_LonPar3Kids",
SUM("VFt_LonPar3Kids") AS "VFt_LonPar3Kids",
AVG("VF_FamGT5") AS "VF_FamGT5",
AVG("VFn_FamGT5") AS "VFn_FamGT5",
SUM("VFt_FamGT5") AS "VFt_FamGT5",
AVG("VF_MovedLT1") AS "VF_MovedLT1",
AVG("VFn_MovedLT1") AS "VFn_MovedLT1",
SUM("VFt_MovedLT1") AS "VFt_MovedLT1",
AVG("VF_ImmLT5") AS "VF_ImmLT5",
AVG("VFn_Imm_LT5") AS "VFn_Imm_LT5",
SUM("VFt_ImmLT5") AS"VFt_ImmLT5" ,
AVG("VF_NoWrkPlace") AS "VF_NoWrkPlace",
AVG("VFn_NoWrkPlace") AS "VFn_NoWrkPlace",
SUM("VFt_NoWrkPlace") AS "VFt_NoWrkPlace",

--1.3.3 Individual Autonomy
SUM("VAt_Score") AS "VAt_Score",
AVG("VA_NoEngFr") AS "VA_NoEngFr",
AVG("VAn_NoEngFr") AS "VAn_NoEngFr",
SUM("VAt_NoEngFr") AS "VAt_NoEngFr",
AVG("VA_NoSecED") AS "VA_NoSecED",
AVG("VAn_NoSecED") AS "VAn_NoSecED",
SUM("VAt_NoSecED") AS "VAt_NoSecED",
AVG("VA_AgeGT65") AS "VA_AgeGT65",
AVG("VAn_AgeGT65") AS "VAn_AgeGT65",
SUM("VAt_AgeGT65") AS "VAt_AgeGT65",
AVG("VA_AgeLT6") AS "VA_AgeLT6",
AVG("VAn_AgeLT6") AS "VAn_AgeLT6",
SUM("VAt_AgeLT6") AS "VAt_AgeLT6",
AVG("VA_Indigenous") AS "VA_Indigenous",
AVG("VAn_Indigenous") AS "VAn_Indigenous",
SUM("VAt_Indigenous") AS "VAt_Indigenous",
AVG("VA_VisMinority") AS "VA_VisMinority",
AVG("VAn_VisMinority") AS "VAn_VisMinority",
SUM("VAt_VisMinority") AS "VAt_VisMinority",
PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY "VA_AgeMedian") AS "VA_AgeMedian",
AVG("VAn_AgeMedian") AS "VAn_AgeMedian",
SUM("VAt_AgeMedian") AS "VAt_AgeMedian",
AVG("VA_Health") AS "VA_Health",
AVG("VAn_Health") AS "VAn_Health",
SUM("VAt_Health") AS "VAt_Health",
AVG("VA_PubTrans") AS "VA_PubTrans",
AVG("VAn_PubTrans") AS "VAn_PubTrans",
SUM("VAt_PubTrans") AS "VAt_PubTrans",

--1.3.4 Financial Agency
SUM("VEt_Score") AS "VEt_Score",
AVG("VE_ShltrGT30") AS "VE_ShltrGT30",
AVG("VEn_ShltrGT30") AS "VEn_ShltrGT30",
SUM("VEt_ShltrGT30") AS "VEt_ShltrGT30",
AVG("VE_LowIncDec") AS "VE_LowIncDec",
AVG("VEn_LowIncDec") AS "VEn_LowIncDec",
SUM("VEt_LowIncDec") AS "VEt_LowIncDec",
AVG("VE_Unemployed") AS "VE_Unemployed",
AVG("VEn_Unemployed") AS "VEn_Unemployed",
SUM("VEt_Unemployed") AS "VEt_Unemployed",
AVG("VE_IncEmploy") AS "VE_IncEmploy",
AVG("VEn_IncEmploy") AS "VEn_IncEmploy",
SUM("VEt_IncEmploy") AS "VEt_IncEmploy",
PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY "VE_IndivInc") AS "VE_IndivInc",
AVG("VEn_IndivInc") AS "VEn_IndivInc",
SUM("VEt_IndivInc") AS "VEt_IndivInc",
PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY "VE_HshldInc") AS "VE_HshldInc",
AVG("VEn_HshldInc") AS "VEn_HshldInc",
SUM("VEt_HshldInc") AS "VEt_HshldInc",
AVG("VE_Retail") AS "VE_Retail",
AVG("VEn_Retail") AS "VEn_Retail",
SUM("VEt_Retail") AS "VEt_Retail",
AVG("VE_WorkNone") AS "VE_WorkNone",
AVG("VEn_WorkNone") AS "VEn_WorkNone" ,
SUM("VEt_WorkNone") AS "VEt_WorkNone",
AVG("VE_WorkPart") AS "VE_WorkPart",
AVG("VEn_WorkPart") AS "VEn_WorkPart",
SUM("VEt_WorkPart") AS "VEt_WorkPart",

c.geom

FROM results_nhsl_social_fabric.nhsl_social_fabric_all_indicators_s a
LEFT JOIN boundaries."SAUID_HexGrid" b ON a."Sauid" = b.sauid
LEFT JOIN boundaries."HexGrid_10km" c ON b.gridid_10 = c.gridid_10
GROUP BY b.gridid_10,c.geom;



--25km
DROP VIEW IF EXISTS results_nhsl_social_fabric.nhsl_social_fabric_all_indicators_hexgrid_25km_centroid;
CREATE VIEW results_nhsl_social_fabric.nhsl_social_fabric_all_indicators_hexgrid_25km_centroid AS 
SELECT
b.gridid_25,
SUM("SVlt_Score") AS "SVlt_Score",

--1.3.1 Housing Conditions
SUM("VHt_Score") AS "VHt_Score",
AVG("VH_PopHa") AS "VH_PopHa",
AVG("VHn_PopHa") AS "VHn_PopHa",
SUM("VHt_PopHa") AS "VHt_PopHa",
AVG("VH_Pre1975") AS "VH_Pre1975",
AVG("VHn_Pre1975") AS "VHn_Pre1975",
SUM("VHtPre1975") AS "VHtPre1975",
AVG("VH_NSuit") AS "VH_NSuit",
AVG("VHn_NSuit") AS "VHn_NSuit",
SUM("VHt_NSuit") AS "VHt_NSuit",
AVG("VH_MntnAge") AS "VH_MntnAge",
AVG("VHn_MntnAge") AS "VHn_MntnAge",
SUM("VHt_MntnAge") AS "VHt_MntnAge",
AVG("VH_Mntn1") AS "VH_Mntn1",
AVG("VHn_Mntn1") AS "VHn_Mntn1",
SUM("VHt_Mntn1") AS "VHt_Mntn1",
AVG("VH_Renter") AS "VH_Renter",
AVG("VHn_Renter") AS "VHn_Renter",
SUM("VHt_Renter") AS "VHt_Renter",
AVG("VH_NonResHa") AS "VH_NonResHa",
AVG("VHn_NonResHa") AS "VHn_NonResHa",
SUM("VHt_NonResHa") AS "VHt_NonResHa",

--1.3.2 Social Connections
SUM("VFt_Score") AS "VFt_Score",
AVG("VF_LivAlone") AS "VF_LivAlone",
AVG("VFn_LivAlone") AS "VFn_LivAlone" ,
SUM("VFt_LivAlone") AS "VFt_LivAlone",
AVG("VF_LonPar3Kids") AS "VF_LonPar3Kids",
AVG("VFn_LonPar3Kids") AS "VFn_LonPar3Kids",
SUM("VFt_LonPar3Kids") AS "VFt_LonPar3Kids",
AVG("VF_FamGT5") AS "VF_FamGT5",
AVG("VFn_FamGT5") AS "VFn_FamGT5",
SUM("VFt_FamGT5") AS "VFt_FamGT5",
AVG("VF_MovedLT1") AS "VF_MovedLT1",
AVG("VFn_MovedLT1") AS "VFn_MovedLT1",
SUM("VFt_MovedLT1") AS "VFt_MovedLT1",
AVG("VF_ImmLT5") AS "VF_ImmLT5",
AVG("VFn_Imm_LT5") AS "VFn_Imm_LT5",
SUM("VFt_ImmLT5") AS"VFt_ImmLT5" ,
AVG("VF_NoWrkPlace") AS "VF_NoWrkPlace",
AVG("VFn_NoWrkPlace") AS "VFn_NoWrkPlace",
SUM("VFt_NoWrkPlace") AS "VFt_NoWrkPlace",

--1.3.3 Individual Autonomy
SUM("VAt_Score") AS "VAt_Score",
AVG("VA_NoEngFr") AS "VA_NoEngFr",
AVG("VAn_NoEngFr") AS "VAn_NoEngFr",
SUM("VAt_NoEngFr") AS "VAt_NoEngFr",
AVG("VA_NoSecED") AS "VA_NoSecED",
AVG("VAn_NoSecED") AS "VAn_NoSecED",
SUM("VAt_NoSecED") AS "VAt_NoSecED",
AVG("VA_AgeGT65") AS "VA_AgeGT65",
AVG("VAn_AgeGT65") AS "VAn_AgeGT65",
SUM("VAt_AgeGT65") AS "VAt_AgeGT65",
AVG("VA_AgeLT6") AS "VA_AgeLT6",
AVG("VAn_AgeLT6") AS "VAn_AgeLT6",
SUM("VAt_AgeLT6") AS "VAt_AgeLT6",
AVG("VA_Indigenous") AS "VA_Indigenous",
AVG("VAn_Indigenous") AS "VAn_Indigenous",
SUM("VAt_Indigenous") AS "VAt_Indigenous",
AVG("VA_VisMinority") AS "VA_VisMinority",
AVG("VAn_VisMinority") AS "VAn_VisMinority",
SUM("VAt_VisMinority") AS "VAt_VisMinority",
PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY "VA_AgeMedian") AS "VA_AgeMedian",
AVG("VAn_AgeMedian") AS "VAn_AgeMedian",
SUM("VAt_AgeMedian") AS "VAt_AgeMedian",
AVG("VA_Health") AS "VA_Health",
AVG("VAn_Health") AS "VAn_Health",
SUM("VAt_Health") AS "VAt_Health",
AVG("VA_PubTrans") AS "VA_PubTrans",
AVG("VAn_PubTrans") AS "VAn_PubTrans",
SUM("VAt_PubTrans") AS "VAt_PubTrans",

--1.3.4 Financial Agency
SUM("VEt_Score") AS "VEt_Score",
AVG("VE_ShltrGT30") AS "VE_ShltrGT30",
AVG("VEn_ShltrGT30") AS "VEn_ShltrGT30",
SUM("VEt_ShltrGT30") AS "VEt_ShltrGT30",
AVG("VE_LowIncDec") AS "VE_LowIncDec",
AVG("VEn_LowIncDec") AS "VEn_LowIncDec",
SUM("VEt_LowIncDec") AS "VEt_LowIncDec",
AVG("VE_Unemployed") AS "VE_Unemployed",
AVG("VEn_Unemployed") AS "VEn_Unemployed",
SUM("VEt_Unemployed") AS "VEt_Unemployed",
AVG("VE_IncEmploy") AS "VE_IncEmploy",
AVG("VEn_IncEmploy") AS "VEn_IncEmploy",
SUM("VEt_IncEmploy") AS "VEt_IncEmploy",
PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY "VE_IndivInc") AS "VE_IndivInc",
AVG("VEn_IndivInc") AS "VEn_IndivInc",
SUM("VEt_IndivInc") AS "VEt_IndivInc",
PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY "VE_HshldInc") AS "VE_HshldInc",
AVG("VEn_HshldInc") AS "VEn_HshldInc",
SUM("VEt_HshldInc") AS "VEt_HshldInc",
AVG("VE_Retail") AS "VE_Retail",
AVG("VEn_Retail") AS "VEn_Retail",
SUM("VEt_Retail") AS "VEt_Retail",
AVG("VE_WorkNone") AS "VE_WorkNone",
AVG("VEn_WorkNone") AS "VEn_WorkNone" ,
SUM("VEt_WorkNone") AS "VEt_WorkNone",
AVG("VE_WorkPart") AS "VE_WorkPart",
AVG("VEn_WorkPart") AS "VEn_WorkPart",
SUM("VEt_WorkPart") AS "VEt_WorkPart",

c.geom

FROM results_nhsl_social_fabric.nhsl_social_fabric_all_indicators_s a
LEFT JOIN boundaries."SAUID_HexGrid" b ON a."Sauid" = b.sauid
LEFT JOIN boundaries."HexGrid_25km" c ON b.gridid_25 = c.gridid_25
GROUP BY b.gridid_25,c.geom;



--50km
DROP VIEW IF EXISTS results_nhsl_social_fabric.nhsl_social_fabric_all_indicators_hexgrid_50km_centroid;
CREATE VIEW results_nhsl_social_fabric.nhsl_social_fabric_all_indicators_hexgrid_50km_centroid AS 
SELECT
b.gridid_50,
SUM("SVlt_Score") AS "SVlt_Score",

--1.3.1 Housing Conditions
SUM("VHt_Score") AS "VHt_Score",
AVG("VH_PopHa") AS "VH_PopHa",
AVG("VHn_PopHa") AS "VHn_PopHa",
SUM("VHt_PopHa") AS "VHt_PopHa",
AVG("VH_Pre1975") AS "VH_Pre1975",
AVG("VHn_Pre1975") AS "VHn_Pre1975",
SUM("VHtPre1975") AS "VHtPre1975",
AVG("VH_NSuit") AS "VH_NSuit",
AVG("VHn_NSuit") AS "VHn_NSuit",
SUM("VHt_NSuit") AS "VHt_NSuit",
AVG("VH_MntnAge") AS "VH_MntnAge",
AVG("VHn_MntnAge") AS "VHn_MntnAge",
SUM("VHt_MntnAge") AS "VHt_MntnAge",
AVG("VH_Mntn1") AS "VH_Mntn1",
AVG("VHn_Mntn1") AS "VHn_Mntn1",
SUM("VHt_Mntn1") AS "VHt_Mntn1",
AVG("VH_Renter") AS "VH_Renter",
AVG("VHn_Renter") AS "VHn_Renter",
SUM("VHt_Renter") AS "VHt_Renter",
AVG("VH_NonResHa") AS "VH_NonResHa",
AVG("VHn_NonResHa") AS "VHn_NonResHa",
SUM("VHt_NonResHa") AS "VHt_NonResHa",

--1.3.2 Social Connections
SUM("VFt_Score") AS "VFt_Score",
AVG("VF_LivAlone") AS "VF_LivAlone",
AVG("VFn_LivAlone") AS "VFn_LivAlone" ,
SUM("VFt_LivAlone") AS "VFt_LivAlone",
AVG("VF_LonPar3Kids") AS "VF_LonPar3Kids",
AVG("VFn_LonPar3Kids") AS "VFn_LonPar3Kids",
SUM("VFt_LonPar3Kids") AS "VFt_LonPar3Kids",
AVG("VF_FamGT5") AS "VF_FamGT5",
AVG("VFn_FamGT5") AS "VFn_FamGT5",
SUM("VFt_FamGT5") AS "VFt_FamGT5",
AVG("VF_MovedLT1") AS "VF_MovedLT1",
AVG("VFn_MovedLT1") AS "VFn_MovedLT1",
SUM("VFt_MovedLT1") AS "VFt_MovedLT1",
AVG("VF_ImmLT5") AS "VF_ImmLT5",
AVG("VFn_Imm_LT5") AS "VFn_Imm_LT5",
SUM("VFt_ImmLT5") AS"VFt_ImmLT5" ,
AVG("VF_NoWrkPlace") AS "VF_NoWrkPlace",
AVG("VFn_NoWrkPlace") AS "VFn_NoWrkPlace",
SUM("VFt_NoWrkPlace") AS "VFt_NoWrkPlace",

--1.3.3 Individual Autonomy
SUM("VAt_Score") AS "VAt_Score",
AVG("VA_NoEngFr") AS "VA_NoEngFr",
AVG("VAn_NoEngFr") AS "VAn_NoEngFr",
SUM("VAt_NoEngFr") AS "VAt_NoEngFr",
AVG("VA_NoSecED") AS "VA_NoSecED",
AVG("VAn_NoSecED") AS "VAn_NoSecED",
SUM("VAt_NoSecED") AS "VAt_NoSecED",
AVG("VA_AgeGT65") AS "VA_AgeGT65",
AVG("VAn_AgeGT65") AS "VAn_AgeGT65",
SUM("VAt_AgeGT65") AS "VAt_AgeGT65",
AVG("VA_AgeLT6") AS "VA_AgeLT6",
AVG("VAn_AgeLT6") AS "VAn_AgeLT6",
SUM("VAt_AgeLT6") AS "VAt_AgeLT6",
AVG("VA_Indigenous") AS "VA_Indigenous",
AVG("VAn_Indigenous") AS "VAn_Indigenous",
SUM("VAt_Indigenous") AS "VAt_Indigenous",
AVG("VA_VisMinority") AS "VA_VisMinority",
AVG("VAn_VisMinority") AS "VAn_VisMinority",
SUM("VAt_VisMinority") AS "VAt_VisMinority",
PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY "VA_AgeMedian") AS "VA_AgeMedian",
AVG("VAn_AgeMedian") AS "VAn_AgeMedian",
SUM("VAt_AgeMedian") AS "VAt_AgeMedian",
AVG("VA_Health") AS "VA_Health",
AVG("VAn_Health") AS "VAn_Health",
SUM("VAt_Health") AS "VAt_Health",
AVG("VA_PubTrans") AS "VA_PubTrans",
AVG("VAn_PubTrans") AS "VAn_PubTrans",
SUM("VAt_PubTrans") AS "VAt_PubTrans",

--1.3.4 Financial Agency
SUM("VEt_Score") AS "VEt_Score",
AVG("VE_ShltrGT30") AS "VE_ShltrGT30",
AVG("VEn_ShltrGT30") AS "VEn_ShltrGT30",
SUM("VEt_ShltrGT30") AS "VEt_ShltrGT30",
AVG("VE_LowIncDec") AS "VE_LowIncDec",
AVG("VEn_LowIncDec") AS "VEn_LowIncDec",
SUM("VEt_LowIncDec") AS "VEt_LowIncDec",
AVG("VE_Unemployed") AS "VE_Unemployed",
AVG("VEn_Unemployed") AS "VEn_Unemployed",
SUM("VEt_Unemployed") AS "VEt_Unemployed",
AVG("VE_IncEmploy") AS "VE_IncEmploy",
AVG("VEn_IncEmploy") AS "VEn_IncEmploy",
SUM("VEt_IncEmploy") AS "VEt_IncEmploy",
PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY "VE_IndivInc") AS "VE_IndivInc",
AVG("VEn_IndivInc") AS "VEn_IndivInc",
SUM("VEt_IndivInc") AS "VEt_IndivInc",
PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY "VE_HshldInc") AS "VE_HshldInc",
AVG("VEn_HshldInc") AS "VEn_HshldInc",
SUM("VEt_HshldInc") AS "VEt_HshldInc",
AVG("VE_Retail") AS "VE_Retail",
AVG("VEn_Retail") AS "VEn_Retail",
SUM("VEt_Retail") AS "VEt_Retail",
AVG("VE_WorkNone") AS "VE_WorkNone",
AVG("VEn_WorkNone") AS "VEn_WorkNone" ,
SUM("VEt_WorkNone") AS "VEt_WorkNone",
AVG("VE_WorkPart") AS "VE_WorkPart",
AVG("VEn_WorkPart") AS "VEn_WorkPart",
SUM("VEt_WorkPart") AS "VEt_WorkPart",

c.geom

FROM results_nhsl_social_fabric.nhsl_social_fabric_all_indicators_s a
LEFT JOIN boundaries."SAUID_HexGrid" b ON a."Sauid" = b.sauid
LEFT JOIN boundaries."HexGrid_50km" c ON b.gridid_50 = c.gridid_50
GROUP BY b.gridid_50,c.geom;



--100km
DROP VIEW IF EXISTS results_nhsl_social_fabric.nhsl_social_fabric_all_indicators_hexgrid_100km_centroid;
CREATE VIEW results_nhsl_social_fabric.nhsl_social_fabric_all_indicators_hexgrid_100km_centroid AS 
SELECT
b.gridid_100,
SUM("SVlt_Score") AS "SVlt_Score",

--1.3.1 Housing Conditions
SUM("VHt_Score") AS "VHt_Score",
AVG("VH_PopHa") AS "VH_PopHa",
AVG("VHn_PopHa") AS "VHn_PopHa",
SUM("VHt_PopHa") AS "VHt_PopHa",
AVG("VH_Pre1975") AS "VH_Pre1975",
AVG("VHn_Pre1975") AS "VHn_Pre1975",
SUM("VHtPre1975") AS "VHtPre1975",
AVG("VH_NSuit") AS "VH_NSuit",
AVG("VHn_NSuit") AS "VHn_NSuit",
SUM("VHt_NSuit") AS "VHt_NSuit",
AVG("VH_MntnAge") AS "VH_MntnAge",
AVG("VHn_MntnAge") AS "VHn_MntnAge",
SUM("VHt_MntnAge") AS "VHt_MntnAge",
AVG("VH_Mntn1") AS "VH_Mntn1",
AVG("VHn_Mntn1") AS "VHn_Mntn1",
SUM("VHt_Mntn1") AS "VHt_Mntn1",
AVG("VH_Renter") AS "VH_Renter",
AVG("VHn_Renter") AS "VHn_Renter",
SUM("VHt_Renter") AS "VHt_Renter",
AVG("VH_NonResHa") AS "VH_NonResHa",
AVG("VHn_NonResHa") AS "VHn_NonResHa",
SUM("VHt_NonResHa") AS "VHt_NonResHa",

--1.3.2 Social Connections
SUM("VFt_Score") AS "VFt_Score",
AVG("VF_LivAlone") AS "VF_LivAlone",
AVG("VFn_LivAlone") AS "VFn_LivAlone" ,
SUM("VFt_LivAlone") AS "VFt_LivAlone",
AVG("VF_LonPar3Kids") AS "VF_LonPar3Kids",
AVG("VFn_LonPar3Kids") AS "VFn_LonPar3Kids",
SUM("VFt_LonPar3Kids") AS "VFt_LonPar3Kids",
AVG("VF_FamGT5") AS "VF_FamGT5",
AVG("VFn_FamGT5") AS "VFn_FamGT5",
SUM("VFt_FamGT5") AS "VFt_FamGT5",
AVG("VF_MovedLT1") AS "VF_MovedLT1",
AVG("VFn_MovedLT1") AS "VFn_MovedLT1",
SUM("VFt_MovedLT1") AS "VFt_MovedLT1",
AVG("VF_ImmLT5") AS "VF_ImmLT5",
AVG("VFn_Imm_LT5") AS "VFn_Imm_LT5",
SUM("VFt_ImmLT5") AS"VFt_ImmLT5" ,
AVG("VF_NoWrkPlace") AS "VF_NoWrkPlace",
AVG("VFn_NoWrkPlace") AS "VFn_NoWrkPlace",
SUM("VFt_NoWrkPlace") AS "VFt_NoWrkPlace",

--1.3.3 Individual Autonomy
SUM("VAt_Score") AS "VAt_Score",
AVG("VA_NoEngFr") AS "VA_NoEngFr",
AVG("VAn_NoEngFr") AS "VAn_NoEngFr",
SUM("VAt_NoEngFr") AS "VAt_NoEngFr",
AVG("VA_NoSecED") AS "VA_NoSecED",
AVG("VAn_NoSecED") AS "VAn_NoSecED",
SUM("VAt_NoSecED") AS "VAt_NoSecED",
AVG("VA_AgeGT65") AS "VA_AgeGT65",
AVG("VAn_AgeGT65") AS "VAn_AgeGT65",
SUM("VAt_AgeGT65") AS "VAt_AgeGT65",
AVG("VA_AgeLT6") AS "VA_AgeLT6",
AVG("VAn_AgeLT6") AS "VAn_AgeLT6",
SUM("VAt_AgeLT6") AS "VAt_AgeLT6",
AVG("VA_Indigenous") AS "VA_Indigenous",
AVG("VAn_Indigenous") AS "VAn_Indigenous",
SUM("VAt_Indigenous") AS "VAt_Indigenous",
AVG("VA_VisMinority") AS "VA_VisMinority",
AVG("VAn_VisMinority") AS "VAn_VisMinority",
SUM("VAt_VisMinority") AS "VAt_VisMinority",
PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY "VA_AgeMedian") AS "VA_AgeMedian",
AVG("VAn_AgeMedian") AS "VAn_AgeMedian",
SUM("VAt_AgeMedian") AS "VAt_AgeMedian",
AVG("VA_Health") AS "VA_Health",
AVG("VAn_Health") AS "VAn_Health",
SUM("VAt_Health") AS "VAt_Health",
AVG("VA_PubTrans") AS "VA_PubTrans",
AVG("VAn_PubTrans") AS "VAn_PubTrans",
SUM("VAt_PubTrans") AS "VAt_PubTrans",

--1.3.4 Financial Agency
SUM("VEt_Score") AS "VEt_Score",
AVG("VE_ShltrGT30") AS "VE_ShltrGT30",
AVG("VEn_ShltrGT30") AS "VEn_ShltrGT30",
SUM("VEt_ShltrGT30") AS "VEt_ShltrGT30",
AVG("VE_LowIncDec") AS "VE_LowIncDec",
AVG("VEn_LowIncDec") AS "VEn_LowIncDec",
SUM("VEt_LowIncDec") AS "VEt_LowIncDec",
AVG("VE_Unemployed") AS "VE_Unemployed",
AVG("VEn_Unemployed") AS "VEn_Unemployed",
SUM("VEt_Unemployed") AS "VEt_Unemployed",
AVG("VE_IncEmploy") AS "VE_IncEmploy",
AVG("VEn_IncEmploy") AS "VEn_IncEmploy",
SUM("VEt_IncEmploy") AS "VEt_IncEmploy",
PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY "VE_IndivInc") AS "VE_IndivInc",
AVG("VEn_IndivInc") AS "VEn_IndivInc",
SUM("VEt_IndivInc") AS "VEt_IndivInc",
PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY "VE_HshldInc") AS "VE_HshldInc",
AVG("VEn_HshldInc") AS "VEn_HshldInc",
SUM("VEt_HshldInc") AS "VEt_HshldInc",
AVG("VE_Retail") AS "VE_Retail",
AVG("VEn_Retail") AS "VEn_Retail",
SUM("VEt_Retail") AS "VEt_Retail",
AVG("VE_WorkNone") AS "VE_WorkNone",
AVG("VEn_WorkNone") AS "VEn_WorkNone" ,
SUM("VEt_WorkNone") AS "VEt_WorkNone",
AVG("VE_WorkPart") AS "VE_WorkPart",
AVG("VEn_WorkPart") AS "VEn_WorkPart",
SUM("VEt_WorkPart") AS "VEt_WorkPart",

c.geom

FROM results_nhsl_social_fabric.nhsl_social_fabric_all_indicators_s a
LEFT JOIN boundaries."SAUID_HexGrid" b ON a."Sauid" = b.sauid
LEFT JOIN boundaries."HexGrid_100km" c ON b.gridid_100 = c.gridid_100
GROUP BY b.gridid_100,c.geom;